<x-client-layout> <div class="max-w-3xl mx-auto space-y-6"> <!-- Page Header --> <div> <a href="{{ route('dashboard.orders.show', $order) }}" class="inline-flex items-center text-sm text-gray-500 hover:text-gray-700 mb-4"> <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"> <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path> </svg> Back to Order </a> <h2 class="text-2xl font-bold text-gray-900"> Complete Payment </h2> <p class="mt-1 text-sm text-gray-500"> Order #{{ $order->id }} </p> </div> <!-- Order Summary --> <div class="bg-white shadow-sm rounded-lg border border-gray-200 p-6"> <h3 class="text-lg font-medium text-gray-900 mb-4"> Order Summary </h3> @php $breakdown = $order->pricing_breakdown ?? []; $cardConfigs = $breakdown['card_configurations'] ?? []; $subscriptionYears = $order->subscription_years ?? 1; $isRenewal = $order->profile_id !== null; $renewalProfile = $isRenewal ? \App\Models\Profile::find($order->profile_id) : null; $durationDays = ($order->package->subscription_duration_days ?? 365) * $subscriptionYears; @endphp @if($isRenewal && $renewalProfile) <!-- Renewal Order Summary --> <div class="mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg"> <p class="text-sm font-medium text-blue-800"> ðŸ”„ Subscription Renewal Order </p> <p class="text-xs text-blue-600 mt-1"> Renewing: {{ $renewalProfile->profile_name ?? $renewalProfile->slug }} </p> </div> @endif <dl class="space-y-2"> <div class="flex justify-between text-sm"> <dt class="text-gray-600"> @if($isRenewal) Subscription Renewal - {{ $subscriptionYears }} {{ Str::plural('Year', $subscriptionYears) }} @else {{ $order->quantity }} Ã— {{ $order->package->name }} @if($subscriptionYears > 1) <span class="text-xs text-brand-600">({{ $subscriptionYears }} {{ Str::plural('year', $subscriptionYears) }})</span> @endif @endif </dt> <dd class="font-medium text-gray-900"> {{ number_format($order->base_price) }} TZS </dd> </div> @if($order->printing_fee > 0) <div class="flex justify-between text-sm"> <dt class="text-gray-600"> Printing Fees @php $printingCount = collect($cardConfigs)->where('requires_printing', true)->count(); @endphp @if($printingCount > 0) <span class="text-xs">({{ $printingCount }} {{ Str::plural('card', $printingCount) }})</span> @endif </dt> <dd class="font-medium text-gray-900"> {{ number_format($order->printing_fee) }} TZS </dd> </div> @endif @if($order->subscription_discount > 0) <div class="flex justify-between text-sm text-green-600"> <dt class="font-medium">Multi-Year Discount</dt> <dd class="font-medium"> -{{ number_format($order->subscription_discount) }} TZS </dd> </div> @endif <div class="border-t border-gray-200 pt-2 mt-2"> <div class="flex justify-between"> <dt class="text-base font-medium text-gray-900">Total to Pay</dt> <dd class="text-lg font-bold text-brand-600"> {{ number_format($order->total_price) }} TZS </dd> </div> </div> </dl> <div class="mt-4 pt-4 border-t border-gray-200 text-sm text-gray-500 space-y-1"> @if($isRenewal) <p>âœ“ Renewing subscription for {{ $subscriptionYears }} {{ Str::plural('year', $subscriptionYears) }}</p> @if($renewalProfile && $renewalProfile->expires_at) <p>âœ“ Current expiration: {{ $renewalProfile->expires_at->format('M d, Y') }}</p> @php $newExpiration = $renewalProfile->expires_at->copy(); if ($newExpiration->isFuture()) { $newExpiration->addDays($durationDays); } else { $newExpiration = now()->addDays($durationDays); } @endphp <p>âœ“ New expiration: {{ $newExpiration->format('M d, Y') }}</p> @endif @else <p>âœ“ {{ $order->quantity }} {{ Str::plural('Card', $order->quantity) }} with {{ $subscriptionYears }}-{{ Str::plural('year', $subscriptionYears) }} subscription</p> <p>âœ“ Free shipping & delivery</p> <p>âœ“ Cards delivered in 5-7 business days</p> @if(count($cardConfigs) > 0) <div class="mt-3 pt-3 border-t border-gray-200"> <p class="font-medium text-gray-700 mb-2">Card Details:</p> @foreach($cardConfigs as $index => $config) @php $profile = \App\Models\Profile::find($config['profile_id']); @endphp @if($profile) <p class="text-xs"> â€¢ Card {{ $index + 1 }}: {{ $profile->profile_name }} <span class="text-gray-400">â€¢ {{ ucfirst($config['card_color']) }}</span> @if($config['requires_printing']) <span class="text-gray-400">â€¢ Printed</span> @endif </p> @endif @endforeach </div> @endif @endif </div> </div> <!-- Payment Methods --> <div class="bg-white shadow-sm rounded-lg border border-gray-200 p-6"> <h3 class="text-lg font-medium text-gray-900 mb-4"> Select Payment Method </h3> <form method="POST" action="{{ route('dashboard.orders.process-payment', $order) }}" id="paymentForm"> @csrf <div class="space-y-3"> <!-- M-Pesa --> <label class="relative flex items-center p-4 border-2 rounded-lg cursor-pointer transition-all hover:border-brand-400 payment-method-option border-brand-500 bg-brand-50"> <input type="radio" name="payment_method" value="mpesa" checked class="sr-only" onchange="updatePaymentMethod('mpesa')"> <div class="flex items-center flex-1"> <div class="flex-shrink-0"> <div class="h-12 w-12 rounded-lg bg-green-100 flex items-center justify-center"> <span class="text-green-600 font-bold text-lg">M</span> </div> </div> <div class="ml-4"> <h4 class="text-sm font-semibold text-gray-900">M-Pesa</h4> <p class="text-xs text-gray-500">Vodacom Tanzania</p> </div> </div> <div class="flex-shrink-0"> <svg class="h-5 w-5 text-brand-600" fill="currentColor" viewBox="0 0 20 20"> <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/> </svg> </div> </label> <!-- Tigo Pesa --> <label class="relative flex items-center p-4 border-2 rounded-lg cursor-pointer transition-all hover:border-brand-400 payment-method-option border-gray-300"> <input type="radio" name="payment_method" value="tigo_pesa" class="sr-only" onchange="updatePaymentMethod('tigo_pesa')"> <div class="flex items-center flex-1"> <div class="flex-shrink-0"> <div class="h-12 w-12 rounded-lg bg-blue-100 flex items-center justify-center"> <span class="text-blue-600 font-bold text-lg">T</span> </div> </div> <div class="ml-4"> <h4 class="text-sm font-semibold text-gray-900">Tigo Pesa</h4> <p class="text-xs text-gray-500">Tigo Tanzania</p> </div> </div> </label> <!-- Airtel Money --> <label class="relative flex items-center p-4 border-2 rounded-lg cursor-pointer transition-all hover:border-brand-400 payment-method-option border-gray-300"> <input type="radio" name="payment_method" value="airtel_money" class="sr-only" onchange="updatePaymentMethod('airtel_money')"> <div class="flex items-center flex-1"> <div class="flex-shrink-0"> <div class="h-12 w-12 rounded-lg bg-red-100 flex items-center justify-center"> <span class="text-red-600 font-bold text-lg">A</span> </div> </div> <div class="ml-4"> <h4 class="text-sm font-semibold text-gray-900">Airtel Money</h4> <p class="text-xs text-gray-500">Airtel Tanzania</p> </div> </div> </label> <!-- Halopesa --> <label class="relative flex items-center p-4 border-2 rounded-lg cursor-pointer transition-all hover:border-brand-400 payment-method-option border-gray-300"> <input type="radio" name="payment_method" value="halopesa" class="sr-only" onchange="updatePaymentMethod('halopesa')"> <div class="flex items-center flex-1"> <div class="flex-shrink-0"> <div class="h-12 w-12 rounded-lg bg-orange-100 flex items-center justify-center"> <span class="text-orange-600 font-bold text-lg">H</span> </div> </div> <div class="ml-4"> <h4 class="text-sm font-semibold text-gray-900">Halopesa</h4> <p class="text-xs text-gray-500">Halotel Tanzania</p> </div> </div> </label> </div> <!-- Phone Number Input --> <div id="phoneSection" class="mt-6"> <label for="phone_number" class="block text-sm font-medium text-gray-700 mb-2"> Mobile Money Number * </label> <input type="tel" name="phone_number" id="phone_number" required placeholder="e.g., 0712345678" pattern="^0[67]\d{8}$" class="w-full rounded-md border-gray-300 shadow-sm focus:border-brand-500 focus:ring-brand-500"> <p class="mt-1 text-xs text-gray-500"> Enter your mobile number in format: 07XXXXXXXX or 06XXXXXXXX </p> </div> <!-- Payment Button --> <button type="submit" id="payButton" class="mt-6 w-full px-6 py-4 bg-brand-600 hover:bg-brand-700 text-white font-semibold text-lg rounded-lg transition-colors shadow-lg hover:shadow-xl"> Pay {{ number_format($order->total_price) }} TZS </button> <p class="mt-3 text-center text-xs text-gray-500"> You will receive a prompt on your phone to complete the payment </p> </form> </div> <script> function updatePaymentMethod(method) { document.querySelectorAll('.payment-method-option').forEach(opt => { const radio = opt.querySelector('input[type="radio"]'); const isSelected = radio.value === method; opt.classList.toggle('border-brand-500', isSelected); opt.classList.toggle('bg-brand-50', isSelected); opt.classList.toggle('dark:bg-brand-900/20', isSelected); opt.classList.toggle('border-gray-300', !isSelected); opt.classList.toggle('dark:border-gray-600', !isSelected); }); } </script> </div>
</x-client-layout> 